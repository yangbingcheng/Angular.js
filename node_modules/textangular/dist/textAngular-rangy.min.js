!function(n,w){"function"==typeof define&&define.amd?define(n):"undefined"!=typeof module&&"object"==typeof exports?module.exports=n():w.rangy=n()}(function(){function n(c,e){var H=typeof c[e];return H==g||!(H!=d||!c[e])||"unknown"==H}function w(c,e){return!(typeof c[e]!=d||!c[e])}function S(c,e){return typeof c[e]!=f}function N(c){return function(e,H){for(var d=H.length;d--;)if(!c(e,H[d]))return!1;return!0}}function aa(c){return c&&ua(c,Ha)&&va(c,Ia)}function ea(c){return w(c,"body")?c.body:c.getElementsByTagName("body")[0]}
function C(c){typeof console!=f&&n(console,"log")&&console.log(c)}function E(c){l.initialized=!0;l.supported=!1;c="Rangy is not supported in this environment. Reason: "+c;O&&l.config.alertOnFail?alert(c):C(c)}function Y(){if(O&&!l.initialized){var c,e=!1,H=!1;n(document,"createRange")&&(c=document.createRange(),ua(c,u)&&va(c,p)&&(e=!0));var d=ea(document);if(!d||"body"!=d.nodeName.toLowerCase())return void E("No body element found");if(d&&n(d,"createTextRange")&&(c=d.createTextRange(),aa(c)&&(H=!0)),
!e&&!H)return void E("Neither Range nor TextRange are available");l.initialized=!0;l.features={implementsDomRange:e,implementsTextRange:H};var f,g;for(g in W)(f=W[g])instanceof P&&f.init(f,l);e=0;for(H=wa.length;e<H;++e)try{wa[e](l)}catch(xa){c="Rangy init listener threw an exception. Continuing. Detail: "+(xa.message||xa.description||String(xa)),C(c)}}}function Z(c,e,d){d&&(c+=" in module "+d.name);l.warn("DEPRECATED: "+c+" is deprecated. Please use "+e+" instead.")}function J(c,e,d,f){c[e]=function(){return Z(e,
d,f),c[d].apply(c,Q.toArray(arguments))}}function ka(c){c=c||window;Y();for(var e=0,d=ya.length;e<d;++e)ya[e](c)}function P(c,e,d){this.name=c;this.dependencies=e;this.supported=this.initialized=!1;this.initializer=d}function T(c,e,d){e=new P(c,e,function(e){if(!e.initialized){e.initialized=!0;try{d(l,e),e.supported=!0}catch(qa){C("Module '"+c+"' failed to load: "+(qa.message||qa.description||String(qa))),qa.stack&&C(qa.stack)}}});return W[c]=e,e}function fa(){}var d="object",g="function",f="undefined",
p="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),u="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),Ia="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),Ha="collapse compareEndPoints duplicate moveToElementText parentElement select setEndPoint getBoundingClientRect".split(" "),
ua=N(n),U=N(w),va=N(S),W={},O=typeof window!=f&&typeof document!=f,Q={isHostMethod:n,isHostObject:w,isHostProperty:S,areHostMethods:ua,areHostObjects:U,areHostProperties:va,isTextRange:aa,getBody:ea,forEach:[].forEach?function(c,e){c.forEach(e)}:function(c,e){for(var d=0,f=c.length;d<f;++d)e(c[d],d)}},l={version:"1.3.0",initialized:!1,isBrowser:O,supported:!0,util:Q,features:{},modules:W,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==f||rangyAutoInitialize}};
l.fail=E;l.warn=function(c){c="Rangy warning: "+c;O&&l.config.alertOnWarn?alert(c):C(c)};var oa;({}).hasOwnProperty?(Q.extend=oa=function(c,e,d){var f,H,g;for(g in e)e.hasOwnProperty(g)&&(f=c[g],H=e[g],d&&null!==f&&"object"==typeof f&&null!==H&&"object"==typeof H&&oa(f,H,!0),c[g]=H);return e.hasOwnProperty("toString")&&(c.toString=e.toString),c},Q.createOptions=function(c,e){var d={};return oa(d,e),c&&oa(d,c),d}):E("hasOwnProperty not supported");O||E("Rangy can only run in a browser");(function(){var c;
if(O){var e=document.createElement("div");e.appendChild(document.createElement("span"));var d=[].slice;try{1==d.call(e.childNodes,0)[0].nodeType&&(c=function(c){return d.call(c,0)})}catch(Ja){}}c||(c=function(c){for(var e=[],d=0,f=c.length;d<f;++d)e[d]=c[d];return e});Q.toArray=c})();var ra;O&&(n(document,"addEventListener")?ra=function(c,e,d){c.addEventListener(e,d,!1)}:n(document,"attachEvent")?ra=function(c,e,d){c.attachEvent("on"+e,d)}:E("Document does not have required addEventListener or attachEvent method"),
Q.addListener=ra);var wa=[];Q.deprecationNotice=Z;Q.createAliasForDeprecatedMethod=J;l.init=Y;l.addInitListener=function(c){l.initialized?c(l):wa.push(c)};var ya=[];l.addShimListener=function(c){ya.push(c)};O&&(l.shim=l.createMissingNativeApi=ka,J(l,"createMissingNativeApi","shim"));P.prototype={init:function(){for(var c,d,f=this.dependencies||[],g=0,l=f.length;g<l;++g){if(d=f[g],c=W[d],!(c&&c instanceof P))throw Error("required module '"+d+"' not found");if(c.init(),!c.supported)throw Error("required module '"+
d+"' not supported");}this.initializer(this)},fail:function(c){throw this.initialized=!0,this.supported=!1,Error(c);},warn:function(c){l.warn("Module "+this.name+": "+c)},deprecationNotice:function(c,d){l.warn("DEPRECATED: "+c+" in module "+this.name+" is deprecated. Please use "+d+" instead")},createError:function(c){return Error("Error in Rangy "+this.name+" module: "+c)}};l.createModule=function(c){var d,f;2==arguments.length?(d=arguments[1],f=[]):(d=arguments[2],f=arguments[1]);d=T(c,f,d);l.initialized&&
l.supported&&d.init()};l.createCoreModule=function(c,d,f){T(c,d,f)};l.RangePrototype=fa;l.rangePrototype=new fa;l.selectionPrototype=new function(){};l.createCoreModule("DomUtil",[],function(c,d){function e(b){for(var c=0;b=b.previousSibling;)++c;return c}function f(b,c){for(var d=[];b;b=b.parentNode)d.push(b);for(b=c;b;b=b.parentNode)if(A(d,b))return b;return null}function g(b,c,d){for(c=d?c:c.parentNode;c;){if(c===b)return!0;c=c.parentNode}return!1}function l(b,c,d){var x;for(b=d?b:b.parentNode;b;){if(x=
b.parentNode,x===c)return b;b=x}return null}function p(b){b=b.nodeType;return 3==b||4==b||8==b}function u(b,c){var d=c.nextSibling;c=c.parentNode;return d?c.insertBefore(b,d):c.appendChild(b),b}function la(b){if(9==b.nodeType)return b;if(typeof b.ownerDocument!=m)return b.ownerDocument;if(typeof b.document!=m)return b.document;if(b.parentNode)return la(b.parentNode);throw d.createError("getDocument: no document found for node");}function n(b){b=la(b);if(typeof b.defaultView!=m)return b.defaultView;
if(typeof b.parentWindow!=m)return b.parentWindow;throw d.createError("Cannot get a window object for node");}function w(b){if(typeof b.contentDocument!=m)return b.contentDocument;if(typeof b.contentWindow!=m)return b.contentWindow.document;throw d.createError("getIframeDocument: No Document object found for iframe element");}function ga(b){return b&&r.isHostMethod(b,"setTimeout")&&r.isHostObject(b,"document")}function sa(b){return b?p(b)?'"'+b.data+'"':1==b.nodeType?"<"+b.nodeName+(b.id?' id="'+
b.id+'"':"")+">[index:"+e(b)+",length:"+b.childNodes.length+"]["+(b.innerHTML||"[innerHTML not supported]").slice(0,25)+"]":b.nodeName:"[No node]"}function R(b){this._next=this.root=b}function I(b,c){this.node=b;this.offset=c}function v(b){this.code=this[b];this.codeName=b;this.message="DOMException: "+this.codeName}var m="undefined",r=c.util,pa=r.getBody;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||d.fail("document missing a Node creation method");r.isHostMethod(document,
"getElementsByTagName")||d.fail("document missing getElementsByTagName method");var z=document.createElement("div");r.areHostMethods(z,["insertBefore","appendChild","cloneNode"])||d.fail("Incomplete Element implementation");r.isHostProperty(z,"innerHTML")||d.fail("Element is missing innerHTML property");z=document.createTextNode("test");r.areHostMethods(z,["splitText","deleteData","insertData","appendData","cloneNode"])||d.fail("Incomplete Text Node implementation");var A=function(b,c){for(var d=
b.length;d--;)if(b[d]===c)return!0;return!1},ha=!1;!function(){var b=document.createElement("b");b.innerHTML="<br />";ha=!1;c.features.crashyTextNodes=ha}();var K;typeof window.getComputedStyle!=m?K=function(b,c){return n(b).getComputedStyle(b,null)[c]}:typeof document.documentElement.currentStyle!=m?K=function(b,c){return b.currentStyle?b.currentStyle[c]:""}:d.fail("No means of obtaining computed style properties found");R.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var b,
c=this._current=this._next;if(this._current){if(!(b=c.firstChild))for(b=null;c!==this.root&&!(b=c.nextSibling);)c=c.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=null}};I.prototype={equals:function(b){return!!b&&this.node===b.node&&this.offset==b.offset},inspect:function(){return"[DomPosition("+sa(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};v.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,
NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24};v.prototype.toString=function(){return this.message};c.dom={arrayContains:A,isHtmlNamespace:function(b){var c;return typeof b.namespaceURI==m||null===(c=b.namespaceURI)||"http://www.w3.org/1999/xhtml"==c},parentElement:function(b){b=b.parentNode;return 1==b.nodeType?b:null},getNodeIndex:e,getNodeLength:function(b){switch(b.nodeType){case 7:case 10:return 0;case 3:case 8:return b.length;
default:return b.childNodes.length}},getCommonAncestor:f,isAncestorOf:g,isOrIsAncestorOf:function(b,c){return g(b,c,!0)},getClosestAncestorIn:l,isCharacterDataNode:p,isTextOrCommentNode:function(b){if(!b)return!1;b=b.nodeType;return 3==b||8==b},insertAfter:u,splitDataNode:function(b,c,d){var f=b.cloneNode(!1);if(f.deleteData(0,c),b.deleteData(c,b.length-c),u(f,b),d)for(var x,v=0;x=d[v++];)x.node==b&&x.offset>c?(x.node=f,x.offset-=c):x.node==b.parentNode&&x.offset>e(b)&&++x.offset;return f},getDocument:la,
getWindow:n,getIframeWindow:function(b){if(typeof b.contentWindow!=m)return b.contentWindow;if(typeof b.contentDocument!=m)return b.contentDocument.defaultView;throw d.createError("getIframeWindow: No Window object found for iframe element");},getIframeDocument:w,getBody:pa,isWindow:ga,getContentDocument:function(b,c,d){var e;if(b?r.isHostProperty(b,"nodeType")?e=1==b.nodeType&&"iframe"==b.tagName.toLowerCase()?w(b):la(b):ga(b)&&(e=b.document):e=document,!e)throw c.createError(d+"(): Parameter must be a Window object or DOM node");
return e},getRootContainer:function(b){for(var c;c=b.parentNode;)b=c;return b},comparePoints:function(b,c,v,m){var x,r,g,z;if(b==v)return c===m?0:c<m?-1:1;if(x=l(v,b,!0))return c<=e(x)?-1:1;if(x=l(b,v,!0))return e(x)<m?-1:1;if(r=f(b,v),!r)throw Error("comparePoints error: nodes have no common ancestor");if(g=b===r?r:l(b,r,!0),z=v===r?r:l(v,r,!0),g===z)throw d.createError("comparePoints got to case 4 and childA and childB are the same!");for(b=r.firstChild;b;){if(b===g)return-1;if(b===z)return 1;b=
b.nextSibling}},isBrokenNode:function(b){return!1},inspectNode:sa,getComputedStyleProperty:K,createTestElement:function(b,c,d){var e=pa(b);b=b.createElement("div");b.contentEditable=""+!!d;c&&(b.innerHTML=c);c=e.firstChild;return c?e.insertBefore(b,c):e.appendChild(b),b},removeNode:function(b){return b.parentNode.removeChild(b)},fragmentFromNodeChildren:function(b){for(var c,d=la(b).createDocumentFragment();c=b.firstChild;)d.appendChild(c);return d},createIterator:function(b){return new R(b)},DomPosition:I};
c.DOMException=v});l.createCoreModule("DomRange",["DomUtil"],function(c,d){function e(h,a){return 3!=h.nodeType&&(ia(h,a.startContainer)||ia(h,a.endContainer))}function f(h){return h.document||ba(h.startContainer)}function g(h){return new G(h.parentNode,ja(h))}function l(h){return new G(h.parentNode,ja(h)+1)}function p(h,a,b){var c=11==h.nodeType?h.firstChild:h;return B(a)?b==a.length?y.insertAfter(h,a):a.parentNode.insertBefore(h,0==b?a:Q(a,b)):b>=a.childNodes.length?a.appendChild(h):a.insertBefore(h,
a.childNodes[b]),c}function u(a,c,k){if(b(a),b(c),f(c)!=f(a))throw new D("WRONG_DOCUMENT_ERR");var h=F(a.startContainer,a.startOffset,c.endContainer,c.endOffset);a=F(a.endContainer,a.endOffset,c.startContainer,c.startOffset);return k?0>=h&&0<=a:0>h&&0<a}function la(a){for(var h,b,c,k=f(a.range).createDocumentFragment();b=a.next();){if(h=a.isPartiallySelectedSubtree(),b=b.cloneNode(!h),h&&(c=a.getSubtreeIterator(),b.appendChild(la(c)),c.detach()),10==b.nodeType)throw new D("HIERARCHY_REQUEST_ERR");
k.appendChild(b)}return k}function n(a,b,c){var h,k;c=c||{stop:!1};for(var d;h=a.next();)if(a.isPartiallySelectedSubtree()){if(!1===b(h))return void(c.stop=!0);if(d=a.getSubtreeIterator(),n(d,b,c),d.detach(),c.stop)break}else for(h=y.createIterator(h);k=h.next();)if(!1===b(k))return void(c.stop=!0)}function w(a){for(var h;a.next();)a.isPartiallySelectedSubtree()?(h=a.getSubtreeIterator(),w(h),h.detach()):a.remove()}function ga(a){for(var h,b,c=f(a.range).createDocumentFragment();h=a.next();){if(a.isPartiallySelectedSubtree()?
(h=h.cloneNode(!1),b=a.getSubtreeIterator(),h.appendChild(ga(b)),b.detach()):a.remove(),10==h.nodeType)throw new D("HIERARCHY_REQUEST_ERR");c.appendChild(h)}return c}function sa(a,b,c){var h,k=!(!b||!b.length),d=!!c;k&&(h=new RegExp("^("+b.join("|")+")$"));var V=[];return n(new I(a,!1),function(b){if(!(k&&!h.test(b.nodeType)||d&&!c(b))){var q=a.startContainer;b==q&&B(q)&&a.startOffset==q.length||(q=a.endContainer,b==q&&B(q)&&0==a.endOffset||V.push(b))}}),V}function R(a){return"["+("undefined"==typeof a.getName?
"Range":a.getName())+"("+y.inspectNode(a.startContainer)+":"+a.startOffset+", "+y.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function I(a,b){(this.range=a,this.clonePartiallySelectedTextNodes=b,a.collapsed)||(this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset,a=a.commonAncestorContainer,this.sc===this.ec&&B(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==a||B(this.sc)?Aa(this.sc,a,
!0):this.sc.childNodes[this.so],this._last=this.ec!==a||B(this.ec)?Aa(this.ec,a,!0):this.ec.childNodes[this.eo-1]))}function v(a){return function(b,h){var c;for(b=h?b:b.parentNode;b;){if(c=b.nodeType,J(a,c))return b;b=b.parentNode}return null}}function m(a,b){if(k(a,b))throw new D("INVALID_NODE_TYPE_ERR");}function r(a,b){if(!J(b,a.nodeType))throw new D("INVALID_NODE_TYPE_ERR");}function pa(a,b){if(0>b||b>(B(a)?a.length:a.childNodes.length))throw new D("INDEX_SIZE_ERR");}function z(a,b){if(ma(a,!0)!==
ma(b,!0))throw new D("WRONG_DOCUMENT_ERR");}function A(b){if(a(b,!0))throw new D("NO_MODIFICATION_ALLOWED_ERR");}function ha(a,b){return b<=(B(a)?a.length:a.childNodes.length)}function K(a){return!!a.startContainer&&!!a.endContainer&&!(ca&&(y.isBrokenNode(a.startContainer)||y.isBrokenNode(a.endContainer)))&&t(a.startContainer)==t(a.endContainer)&&ha(a.startContainer,a.startOffset)&&ha(a.endContainer,a.endOffset)}function b(a){if(!K(a))throw Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+
a.inspect()+")");}function x(a,c){b(a);var h=a.startContainer,k=a.startOffset,d=a.endContainer,q=a.endOffset,V=h===d;B(d)&&0<q&&q<d.length&&Q(d,q,c);B(h)&&0<k&&k<h.length&&(h=Q(h,k,c),V?(q-=k,d=h):d==h.parentNode&&q>=ja(h)&&q++,k=0);a.setStartAndEnd(h,k,d,q)}function Da(a){b(a);var c=a.commonAncestorContainer.parentNode.cloneNode(!1);return c.appendChild(a.cloneContents()),c.innerHTML}function X(a){a.START_TO_START=Ba;a.START_TO_END=Ea;a.END_TO_END=Ca;a.END_TO_START=Fa;a.NODE_BEFORE=W;a.NODE_AFTER=
Z;a.NODE_BEFORE_AND_AFTER=T;a.NODE_INSIDE=U}function za(a){X(a);X(a.prototype)}function E(a,c){return function(){b(this);var h,k,d=this.startContainer,q=this.startOffset,V=this.commonAncestorContainer,e=new I(this,!0);d!==V&&(h=Aa(d,V,!0),k=l(h),d=k.node,q=k.offset);n(e,A);e.reset();h=a(e);return e.detach(),c(this,d,q,d,q),h}}function O(a,k){function h(a,b){return function(c){r(c,na);r(t(c),S);c=(a?g:l)(c);(b?d:q)(this,c.node,c.offset)}}function d(a,b,c){var h=a.endContainer,d=a.endOffset;b===a.startContainer&&
c===a.startOffset||(t(b)==t(h)&&1!=F(b,c,h,d)||(h=b,d=c),k(a,b,c,h,d))}function q(a,b,c){var h=a.startContainer,d=a.startOffset;b===a.endContainer&&c===a.endOffset||(t(b)==t(h)&&-1!=F(b,c,h,d)||(h=b,d=c),k(a,h,d,b,c))}var V=function(){};V.prototype=c.rangePrototype;a.prototype=new V;C.extend(a.prototype,{setStart:function(a,b){m(a,!0);pa(a,b);d(this,a,b)},setEnd:function(a,b){m(a,!0);pa(a,b);q(this,a,b)},setStartAndEnd:function(){var a=arguments,b=a[0],c=a[1],h=b,d=c;switch(a.length){case 3:d=a[2];
break;case 4:h=a[2],d=a[3]}k(this,b,c,h,d)},setBoundary:function(a,b,c){this["set"+(c?"Start":"End")](a,b)},setStartBefore:h(!0,!0),setStartAfter:h(!1,!0),setEndBefore:h(!0,!1),setEndAfter:h(!1,!1),collapse:function(a){b(this);a?k(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):k(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){m(a,!0);k(this,a,0,a,N(a))},selectNode:function(a){m(a,!1);r(a,na);var b=g(a);a=l(a);
k(this,b.node,b.offset,a.node,a.offset)},extractContents:E(ga,k),deleteContents:E(w,k),canSurroundContents:function(){b(this);A(this.startContainer);A(this.endContainer);var a=new I(this,!0),c=a._first&&e(a._first,this)||a._last&&e(a._last,this);return a.detach(),!c},splitBoundaries:function(){x(this)},splitBoundariesPreservingPositions:function(a){x(this,a)},normalizeBoundaries:function(){b(this);var a,c=this.startContainer,h=this.startOffset,d=this.endContainer,q=this.endOffset,V=function(a){var b=
a.nextSibling;b&&b.nodeType==a.nodeType&&(d=a,q=a.length,a.appendData(b.data),da(b))},e=function(a){var b=a.previousSibling;if(b&&b.nodeType==a.nodeType){c=a;var k=a.length;(h=b.length,a.insertData(0,b.data),da(b),c==d)?(q+=h,d=c):d==a.parentNode&&(b=ja(a),q==b?(d=a,q=k):q>b&&q--)}},f=!0;B(d)?q==d.length?V(d):0==q&&(a=d.previousSibling,a&&a.nodeType==d.nodeType&&(q=a.length,c==d&&(f=!1),a.appendData(d.data),da(d),d=a)):(0<q&&(f=d.childNodes[q-1])&&B(f)&&V(f),f=!this.collapsed);f?B(c)?0==h?e(c):h==
c.length&&(a=c.nextSibling,a&&a.nodeType==c.nodeType&&(d==a&&(d=c,q+=c.length),c.appendData(a.data),da(a))):h<c.childNodes.length&&(a=c.childNodes[h])&&B(a)&&e(a):(c=d,h=q);k(this,c,h,d,q)},collapseToPoint:function(a,b){m(a,!0);pa(a,b);this.setStartAndEnd(a,b)}});za(a)}function P(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:y.getCommonAncestor(a.startContainer,a.endContainer)}function L(a,b,c,d,k){a.startContainer=
b;a.startOffset=c;a.endContainer=d;a.endOffset=k;a.document=y.getDocument(b);P(a)}function M(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this.document=a;P(this)}var y=c.dom,C=c.util,G=y.DomPosition,D=c.DOMException,B=y.isCharacterDataNode,ja=y.getNodeIndex,ia=y.isOrIsAncestorOf,ba=y.getDocument,F=y.comparePoints,Q=y.splitDataNode,Aa=y.getClosestAncestorIn,N=y.getNodeLength,J=y.arrayContains,t=y.getRootContainer,ca=c.features.crashyTextNodes,da=y.removeNode;I.prototype=
{_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,B(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var a,b,c=this._current;
!B(c)||c!==this.sc&&c!==this.ec?c.parentNode&&da(c):(a=c===this.sc?this.so:0,b=c===this.ec?this.eo:c.length,a!=b&&c.deleteData(a,b-a))},isPartiallySelectedSubtree:function(){return e(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse(!1);else{a=new M(f(this.range));var b=this._current,c=b,d=0,k=b,q=N(b);ia(b,this.sc)&&(c=this.sc,d=this.so);ia(b,this.ec)&&(k=this.ec,q=this.eo);L(a,c,d,k,q)}return new I(a,this.clonePartiallySelectedTextNodes)},
detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var na=[1,3,4,5,7,8,10],S=[2,9,11],Y=[1,3,4,5,7,8,10,11],aa=[1,3,4,5,7,8],ma=v([9,11]),a=v([5,6,10,12]),k=v([6,10,12]);d=document.createElement("style");var q=!1;try{d.innerHTML="<b>x</b>",q=3==d.firstChild.nodeType}catch(h){}c.features.htmlParsingConforms=q;var ta="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),Ba=0,Ea=1,Ca=2,Fa=3,W=
0,Z=1,T=2,U=3;C.extend(c.rangePrototype,{compareBoundaryPoints:function(a,c){b(this);z(this.startContainer,c.startContainer);var h,d,k,q,e=a==Fa||a==Ba?"start":"end";a=a==Ea||a==Ba?"start":"end";return h=this[e+"Container"],d=this[e+"Offset"],k=c[a+"Container"],q=c[a+"Offset"],F(h,d,k,q)},insertNode:function(a){if(b(this),r(a,Y),A(this.startContainer),ia(a,this.startContainer))throw new D("HIERARCHY_REQUEST_ERR");a=p(a,this.startContainer,this.startOffset);this.setStartBefore(a)},cloneContents:function(){b(this);
var a,c;if(this.collapsed)return f(this).createDocumentFragment();if(this.startContainer===this.endContainer&&B(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),c=f(this).createDocumentFragment(),c.appendChild(a),c;c=new I(this,!0);return a=la(c),c.detach(),a},canSurroundContents:function(){b(this);A(this.startContainer);A(this.endContainer);var a=new I(this,!0),c=a._first&&e(a._first,this)||a._last&&e(a._last,this);return a.detach(),
!c},surroundContents:function(a){if(r(a,aa),!this.canSurroundContents())throw new D("INVALID_STATE_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);p(a,this.startContainer,this.startOffset);a.appendChild(b);this.selectNode(a)},cloneRange:function(){b(this);for(var a,c=new M(f(this)),d=ta.length;d--;)a=ta[d],c[a]=this[a];return c},toString:function(){b(this);var a=this.startContainer;if(a===this.endContainer&&B(a))return 3==a.nodeType||4==a.nodeType?
a.data.slice(this.startOffset,this.endOffset):"";var c=[],a=new I(this,!0);return n(a,function(a){3!=a.nodeType&&4!=a.nodeType||c.push(a.data)}),a.detach(),c.join("")},compareNode:function(a){b(this);var c=a.parentNode,d=ja(a);if(!c)throw new D("NOT_FOUND_ERR");a=this.comparePoint(c,d);c=this.comparePoint(c,d+1);return 0>a?0<c?T:W:0<c?Z:U},comparePoint:function(a,c){b(this);if(!a)throw new D("HIERARCHY_REQUEST_ERR");return z(a,this.startContainer),0>F(a,c,this.startContainer,this.startOffset)?-1:
0<F(a,c,this.endContainer,this.endOffset)?1:0},createContextualFragment:q?function(a){var b=this.startContainer,c=ba(b);if(!b)throw new D("INVALID_STATE_ERR");var d=null;return 1==b.nodeType?d=b:B(b)&&(d=y.parentElement(b)),d=null===d||"HTML"==d.nodeName&&y.isHtmlNamespace(ba(d).documentElement)&&y.isHtmlNamespace(d)?c.createElement("body"):d.cloneNode(!1),d.innerHTML=a,y.fragmentFromNodeChildren(d)}:function(a){var b=f(this).createElement("body");return b.innerHTML=a,y.fragmentFromNodeChildren(b)},
toHtml:function(){return Da(this)},intersectsNode:function(a,c){if(b(this),t(a)!=t(this.startContainer))return!1;var d=a.parentNode,k=ja(a);if(!d)return!0;a=F(d,k,this.endContainer,this.endOffset);d=F(d,k+1,this.startContainer,this.startOffset);return c?0>=a&&0<=d:0>a&&0<d},isPointInRange:function(a,c){b(this);if(!a)throw new D("HIERARCHY_REQUEST_ERR");return z(a,this.startContainer),0<=F(a,c,this.startContainer,this.startOffset)&&0>=F(a,c,this.endContainer,this.endOffset)},intersectsRange:function(a){return u(this,
a,!1)},intersectsOrTouchesRange:function(a){return u(this,a,!0)},intersection:function(a){if(this.intersectsRange(a)){var b=F(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=F(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();return-1==b&&d.setStart(a.startContainer,a.startOffset),1==c&&d.setEnd(a.endContainer,a.endOffset),d}return null},union:function(a){if(this.intersectsOrTouchesRange(a)){var b=this.cloneRange();return-1==F(a.startContainer,
a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset),1==F(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset),b}throw new D("Ranges do not intersect");},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==U},containsNodeContents:function(a){return 0<=this.comparePoint(a,0)&&0>=this.comparePoint(a,N(a))},containsRange:function(a){var b=this.intersection(a);return null!==b&&a.equals(b)},
containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);return 0<c.length?(b.setStart(c[0],0),a=c.pop(),b.setEnd(a,a.length),this.containsRange(b)):this.containsNodeContents(a)},getNodes:function(a,c){return b(this),sa(this,a,c)},getDocument:function(){return f(this)},collapseBefore:function(a){this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){this.setStartAfter(a);this.collapse(!0)},getBookmark:function(a){var b=f(this),d=c.createRange(b);a=a||y.getBody(b);
d.selectNodeContents(a);var b=this.intersection(d),k=0,q=0;return b&&(d.setEnd(b.startContainer,b.startOffset),k=d.toString().length,q=k+b.toString().length),{start:k,end:q,containerNode:a}},moveToBookmark:function(a){var b=a.containerNode,c=0;this.setStart(b,0);this.collapse(!0);for(var d,k,q,b=[b],e=!1,f=!1;!f&&(d=b.pop());)if(3==d.nodeType)k=c+d.length,!e&&a.start>=c&&a.start<=k&&(this.setStart(d,a.start-c),e=!0),e&&a.end>=c&&a.end<=k&&(this.setEnd(d,a.end-c),f=!0),c=k;else for(q=d.childNodes,
k=q.length;k--;)b.push(q[k])},getName:function(){return"DomRange"},equals:function(a){return M.rangesEqual(this,a)},isValid:function(){return K(this)},inspect:function(){return R(this)},detach:function(){}});O(M,L);C.extend(M,{rangeProperties:ta,RangeIterator:I,copyComparisonConstants:za,createPrototypeRange:O,inspect:R,toHtml:Da,getRangeDocument:f,rangesEqual:function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset}});
c.DomRange=M});l.createCoreModule("WrappedRange",["DomRange"],function(c,d){var f,e,g=c.dom,l=c.util,p=g.DomPosition,n=c.DomRange,u=g.getBody,w=g.getContentDocument,C=g.isCharacterDataNode;if(c.features.implementsDomRange&&!function(){function e(b){for(var c,d=p.length;d--;)c=p[d],b[c]=b.nativeRange[c];b.collapsed=b.startContainer===b.endContainer&&b.startOffset===b.endOffset}var m,r,p=n.rangeProperties;f=function(b){if(!b)throw d.createError("WrappedRange: Range must be specified");this.nativeRange=
b;e(this)};n.createPrototypeRange(f,function(b,c,d,e,f){var g=b.startContainer!==c||b.startOffset!=d,m=b.endContainer!==e||b.endOffset!=f,r=!b.equals(b.nativeRange);(g||m||r)&&(b.setEnd(e,f),b.setStart(c,d))});m=f.prototype;m.selectNode=function(b){this.nativeRange.selectNode(b);e(this)};m.cloneContents=function(){return this.nativeRange.cloneContents()};m.surroundContents=function(b){this.nativeRange.surroundContents(b);e(this)};m.collapse=function(b){this.nativeRange.collapse(b);e(this)};m.cloneRange=
function(){return new f(this.nativeRange.cloneRange())};m.refresh=function(){e(this)};m.toString=function(){return this.nativeRange.toString()};var z=document.createTextNode("test");u(document).appendChild(z);var A=document.createRange();A.setStart(z,0);A.setEnd(z,0);try{A.setStart(z,1),m.setStart=function(b,c){this.nativeRange.setStart(b,c);e(this)},m.setEnd=function(b,c){this.nativeRange.setEnd(b,c);e(this)},r=function(b){return function(c){this.nativeRange[b](c);e(this)}}}catch(b){m.setStart=function(b,
c){try{this.nativeRange.setStart(b,c)}catch(X){this.nativeRange.setEnd(b,c),this.nativeRange.setStart(b,c)}e(this)},m.setEnd=function(b,c){try{this.nativeRange.setEnd(b,c)}catch(X){this.nativeRange.setStart(b,c),this.nativeRange.setEnd(b,c)}e(this)},r=function(b,c){return function(d){try{this.nativeRange[b](d)}catch(za){this.nativeRange[c](d),this.nativeRange[b](d)}e(this)}}}m.setStartBefore=r("setStartBefore","setEndBefore");m.setStartAfter=r("setStartAfter","setEndAfter");m.setEndBefore=r("setEndBefore",
"setStartBefore");m.setEndAfter=r("setEndAfter","setStartAfter");m.selectNodeContents=function(b){this.setStartAndEnd(b,0,g.getNodeLength(b))};A.selectNodeContents(z);A.setEnd(z,3);r=document.createRange();r.selectNodeContents(z);r.setEnd(z,4);r.setStart(z,2);-1==A.compareBoundaryPoints(A.START_TO_END,r)&&1==A.compareBoundaryPoints(A.END_TO_START,r)?m.compareBoundaryPoints=function(b,c){return c=c.nativeRange||c,b==c.START_TO_END?b=c.END_TO_START:b==c.END_TO_START&&(b=c.START_TO_END),this.nativeRange.compareBoundaryPoints(b,
c)}:m.compareBoundaryPoints=function(b,c){return this.nativeRange.compareBoundaryPoints(b,c.nativeRange||c)};r=document.createElement("div");r.innerHTML="123";var ha=r.firstChild,K=u(document);K.appendChild(r);A.setStart(ha,1);A.setEnd(ha,2);A.deleteContents();"13"==ha.data&&(m.deleteContents=function(){this.nativeRange.deleteContents();e(this)},m.extractContents=function(){var b=this.nativeRange.extractContents();return e(this),b});K.removeChild(r);K=null;l.isHostMethod(A,"createContextualFragment")&&
(m.createContextualFragment=function(b){return this.nativeRange.createContextualFragment(b)});u(document).removeChild(z);m.getName=function(){return"WrappedRange"};c.WrappedRange=f;c.createNativeRange=function(b){return b=w(b,d,"createNativeRange"),b.createRange()}}(),c.features.implementsTextRange){var ga=function(c,d,e,f,l){var v=c.duplicate();v.collapse(e);var m=v.parentElement();if(g.isOrIsAncestorOf(d,m)||(m=d),!m.canHaveHTML)return m=new p(m.parentNode,g.getNodeIndex(m)),{boundaryPosition:m,
nodeInfo:{nodeIndex:m.offset,containerElement:m.node}};d=g.getDocument(m).createElement("span");d.parentNode&&g.removeNode(d);var r,b,z=e?"StartToStart":"StartToEnd",n=l&&l.containerElement==m?l.nodeIndex:0,u=m.childNodes.length,w=u;for(l=w;l==u?m.appendChild(d):m.insertBefore(d,m.childNodes[l]),v.moveToElementText(d),r=v.compareEndPoints(z,c),0!=r&&n!=w;){if(-1==r){if(w==n+1)break;n=l}else w=w==n+1?n:l;l=Math.floor((n+w)/2);m.removeChild(d)}if(b=d.nextSibling,-1==r&&b&&C(b)){v.setEndPoint(e?"EndToStart":
"EndToEnd",c);if(/[\r\n]/.test(b.data))for(e=v.duplicate(),f=e.text.replace(/\r\n/g,"\r").length,f=e.moveStart("character",f);-1==e.compareEndPoints("StartToEnd",e);)f++,e.moveStart("character",1);else f=v.text.length;b=new p(b,f)}else b=(f||!e)&&d.previousSibling,b=(e=(f||e)&&d.nextSibling)&&C(e)?new p(e,0):b&&C(b)?new p(b,b.data.length):new p(m,g.getNodeIndex(d));return g.removeNode(d),{boundaryPosition:b,nodeInfo:{nodeIndex:l,containerElement:m}}},E=function(c,d){var e,f,m,v,l=c.offset,p=g.getDocument(c.node),
b=u(p).createTextRange(),n=C(c.node);return n?(e=c.node,f=e.parentNode):(v=c.node.childNodes,e=l<v.length?v[l]:null,f=c.node),m=p.createElement("span"),m.innerHTML="&#feff;",e?f.insertBefore(m,e):f.appendChild(m),b.moveToElementText(m),b.collapse(!d),f.removeChild(m),n&&b[d?"moveStart":"moveEnd"]("character",l),b};e=function(c){this.textRange=c;this.refresh()};e.prototype=new n(document);e.prototype.refresh=function(){var c,d,e,f,l=this.textRange;f=l.parentElement();var p=l.duplicate();p.collapse(!0);
var n=p.parentElement(),p=l.duplicate();p.collapse(!1);l=p.parentElement();n=n==l?n:g.getCommonAncestor(n,l);f=n==f?n:g.getCommonAncestor(f,n);n=this.textRange;0==n.compareEndPoints("StartToEnd",n)?d=c=ga(this.textRange,f,!0,!0).boundaryPosition:(e=ga(this.textRange,f,!0,!1),c=e.boundaryPosition,d=ga(this.textRange,f,!1,!1,e.nodeInfo).boundaryPosition);this.setStart(c.node,c.offset);this.setEnd(d.node,d.offset)};e.prototype.getName=function(){return"WrappedTextRange"};n.copyComparisonConstants(e);
var R=function(c){if(c.collapsed)return E(new p(c.startContainer,c.startOffset),!0);var d=E(new p(c.startContainer,c.startOffset),!0),e=E(new p(c.endContainer,c.endOffset),!1);c=u(n.getRangeDocument(c)).createTextRange();return c.setEndPoint("StartToStart",d),c.setEndPoint("EndToEnd",e),c};if(e.rangeToTextRange=R,e.prototype.toTextRange=function(){return R(this)},c.WrappedTextRange=e,!c.features.implementsDomRange||c.config.preferTextRange){var I=Function("return this;")();"undefined"==typeof I.Range&&
(I.Range=e);c.createNativeRange=function(c){return c=w(c,d,"createNativeRange"),u(c).createTextRange()};c.WrappedRange=e}}c.createRange=function(e){return e=w(e,d,"createRange"),new c.WrappedRange(c.createNativeRange(e))};c.createRangyRange=function(c){return c=w(c,d,"createRangyRange"),new n(c)};l.createAliasForDeprecatedMethod(c,"createIframeRange","createRange");l.createAliasForDeprecatedMethod(c,"createIframeRangyRange","createRangyRange");c.addShimListener(function(d){var e=d.document;"undefined"==
typeof e.createRange&&(e.createRange=function(){return c.createRange(e)});e=d=null})});l.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(c,d){function e(a){return"string"==typeof a?/^backward(s)?$/i.test(a):!!a}function f(a,c){if(a){if(x.isWindow(a))return a;if(a instanceof v)return a.win;a=x.getContentDocument(a,d,c);return x.getWindow(a)}return window}function g(a){return f(a,"getWinSelection").getSelection()}function l(a){return f(a,"getDocSelection").document.selection}
function p(a){var c=!1;return a.anchorNode&&(c=1==x.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)),c}function n(a,c,b){var d=b?"end":"start";b=b?"start":"end";a.anchorNode=c[d+"Container"];a.anchorOffset=c[d+"Offset"];a.focusNode=c[b+"Container"];a.focusOffset=c[b+"Offset"]}function w(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function u(a){var b;return a instanceof J?(b=c.createNativeRange(a.getDocument()),
b.setEnd(a.endContainer,a.endOffset),b.setStart(a.startContainer,a.startOffset)):a instanceof U?b=a.nativeRange:L.implementsDomRange&&a instanceof x.getWindow(a.startContainer).Range&&(b=a),b}function C(a){var c=a.getNodes(),b;a:if(c.length&&1==c[0].nodeType){b=1;for(var e=c.length;b<e;++b)if(!x.isAncestorOf(c[0],c[b])){b=!1;break a}b=!0}else b=!1;if(!b)throw d.createError("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return c[0]}function E(a){return!!a&&
"undefined"!=typeof a.text}function O(a,c){c=new U(c);a._ranges=[c];n(a,c,!1);a.rangeCount=1;a.isCollapsed=c.collapsed}function R(a){if(a._ranges.length=0,"None"==a.docSelection.type)w(a);else{var b=a.docSelection.createRange();if(E(b))O(a,b);else{a.rangeCount=b.length;for(var d,e=M(b.item(0)),f=0;f<a.rangeCount;++f)d=c.createRange(e),d.selectNode(b.item(f)),a._ranges.push(d);a.isCollapsed=1==a.rangeCount&&a._ranges[0].collapsed;n(a,a._ranges[a.rangeCount-1],!1)}}}function I(a,c){var b=a.docSelection.createRange();
c=C(c);for(var k=M(b.item(0)),k=y(k).createControlRange(),e=0,f=b.length;e<f;++e)k.add(b.item(e));try{k.add(c)}catch(Ca){throw d.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}k.select();R(a)}function v(a,c,b){this.nativeSelection=a;this.docSelection=c;this._ranges=[];this.win=b;this.refresh()}function m(a){a.win=a.anchorNode=a.focusNode=a._ranges=null;a.rangeCount=a.anchorOffset=a.focusOffset=0;a.detached=!0}function r(a,
c){for(var b,d,k=na.length;k--;)if(b=na[k],d=b.selection,"deleteAll"==c)m(d);else if(b.win==a)return"delete"==c?(na.splice(k,1),!0):d;return"deleteAll"==c&&(na.length=0),null}function P(a,c){var b;b=M(c[0].startContainer);for(var k=y(b).createControlRange(),e=0,f=c.length;e<f;++e){b=C(c[e]);try{k.add(b)}catch(Ca){throw d.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)");}}k.select();R(a)}function z(a,c){if(a.win.document!=
M(c))throw new S("WRONG_DOCUMENT_ERR");}function A(a){return function(b,d){var k;this.rangeCount?(k=this.getRangeAt(0),k["set"+(a?"Start":"End")](b,d)):(k=c.createRange(this.win.document),k.setStartAndEnd(b,d));this.setSingleRange(k,this.isBackward())}}function Q(a){var c=[],b=new Y(a.anchorNode,a.anchorOffset),d=new Y(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,g=a.rangeCount;f<g;++f)c[f]=J.inspect(a.getRangeAt(f));
return"["+e+"(Ranges: "+c.join(", ")+")(anchor: "+b.inspect()+", focus: "+d.inspect()+"]"}c.config.checkSelectionRanges=!0;var K,b,x=c.dom,N=c.util,X=N.isHostMethod,J=c.DomRange,U=c.WrappedRange,S=c.DOMException,Y=x.DomPosition,L=c.features,M=x.getDocument,y=x.getBody,W=J.rangesEqual,G=X(window,"getSelection"),D=N.isHostObject(document,"selection");L.implementsWinGetSelection=G;var B=(L.implementsDocSelection=D)&&(!G||c.config.preferTextRange);if(B)K=l,c.isSelectionValid=function(a){a=f(a,"isSelectionValid").document;
var c=a.selection;return"None"!=c.type||M(c.createRange().parentElement())==a};else{if(!G)return d.fail("Neither document.selection or window.getSelection() detected."),!1;K=g;c.isSelectionValid=function(){return!0}}c.getNativeSelection=K;G=K();if(!G)return d.fail("Native selection was null (possibly issue 138?)"),!1;var ja=c.createNativeRange(document),ia=y(document),ba=N.areHostProperties(G,["anchorNode","focusNode","anchorOffset","focusOffset"]);L.selectionHasAnchorAndFocus=ba;var F=X(G,"extend");
L.selectionHasExtend=F;var Z="number"==typeof G.rangeCount;L.selectionHasRangeCount=Z;var T=!1,aa=!0,ea=F?function(a,b){var d=J.getRangeDocument(b),d=c.createRange(d);d.collapseToPoint(b.endContainer,b.endOffset);a.addRange(u(d));a.extend(b.startContainer,b.startOffset)}:null;N.areHostMethods(G,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof G.rangeCount&&L.implementsDomRange&&!function(){var a=window.getSelection();if(a){for(var b=a.rangeCount,d=1<b,e=[],f=p(a),g=0;g<b;++g)e[g]=a.getRangeAt(g);
var g=x.createTestElement(document,"",!1),l=g.appendChild(document.createTextNode("\u00a0\u00a0\u00a0")),m=document.createRange();(m.setStart(l,1),m.collapse(!0),a.removeAllRanges(),a.addRange(m),aa=1==a.rangeCount,a.removeAllRanges(),d)||((d=window.navigator.appVersion.match(/Chrome\/(.*?) /))&&36<=parseInt(d[1])?T=!1:(d=m.cloneRange(),m.setStart(l,0),d.setEnd(l,3),d.setStart(l,2),a.addRange(m),a.addRange(d),T=2==a.rangeCount));x.removeNode(g);a.removeAllRanges();for(g=0;g<b;++g)0==g&&f?ea?ea(a,
e[g]):(c.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),a.addRange(e[g])):a.addRange(e[g])}}();L.selectionSupportsMultipleRanges=T;L.collapsedNonEditableSelectionsSupported=aa;var t,ca=!1;ia&&X(ia,"createControlRange")&&(t=ia.createControlRange(),N.areHostProperties(t,["item","add"])&&(ca=!0));L.implementsControlRange=ca;b=ba?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===
a.focusOffset}:function(a){return!!a.rangeCount&&a.getRangeAt(a.rangeCount-1).collapsed};var da;X(G,"getRangeAt")?da=function(a,c){try{return a.getRangeAt(c)}catch(q){return null}}:ba&&(da=function(a){var b=M(a.anchorNode),b=c.createRange(b);return b.setStartAndEnd(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset),b.collapsed!==this.isCollapsed&&b.setStartAndEnd(a.focusNode,a.focusOffset,a.anchorNode,a.anchorOffset),b});v.prototype=c.selectionPrototype;var na=[],ka=function(a){if(a&&a instanceof
v)return a.refresh(),a;a=f(a,"getNativeSelection");var b=r(a),c=K(a),d=D?l(a):null;return b?(b.nativeSelection=c,b.docSelection=d,b.refresh()):(b=new v(c,d,a),na.push({win:a,selection:b})),b};c.getSelection=ka;N.createAliasForDeprecatedMethod(c,"getIframeSelection","getSelection");t=v.prototype;if(!B&&ba&&N.areHostMethods(G,["removeAllRanges","addRange"]))t.removeAllRanges=function(){this.nativeSelection.removeAllRanges();w(this)},Z?t.addRange=function(a,d){if(ca&&D&&"Control"==this.docSelection.type)I(this,
a);else if(e(d)&&F)ea(this.nativeSelection,a),this.refresh();else{var k;T?k=this.rangeCount:(this.removeAllRanges(),k=0);d=u(a).cloneRange();try{this.nativeSelection.addRange(d)}catch(ta){}(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==k+1)?(c.config.checkSelectionRanges&&(k=da(this.nativeSelection,this.rangeCount-1))&&!W(k,a)&&(a=new U(k)),this._ranges[this.rangeCount-1]=a,n(this,a,ma(this.nativeSelection)),this.isCollapsed=b(this)):this.refresh()}}:t.addRange=function(a,b){e(b)&&
F?ea(this.nativeSelection,a):this.nativeSelection.addRange(u(a));this.refresh()},t.setRanges=function(a){if(ca&&D&&1<a.length)P(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}};else{if(!(X(G,"empty")&&X(ja,"select")&&ca&&B))return d.fail("No means of selecting a Range or TextRange was found"),!1;t.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=M(this.anchorNode);else if("Control"==this.docSelection.type){var b=
this.docSelection.createRange();b.length&&(a=M(b.item(0)))}a&&(y(a).createTextRange().select(),this.docSelection.empty())}}catch(q){}w(this)};t.addRange=function(a){"Control"==this.docSelection.type?I(this,a):(c.WrappedTextRange.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,n(this,a,!1))};t.setRanges=function(a){this.removeAllRanges();var b=a.length;1<b?P(this,a):b&&this.addRange(a[0])}}t.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new S("INDEX_SIZE_ERR");
return this._ranges[a].cloneRange()};var fa;if(B)fa=function(a){var b;c.isSelectionValid(a.win)?b=a.docSelection.createRange():(b=y(a.win.document).createTextRange(),b.collapse(!0));"Control"==a.docSelection.type?R(a):E(b)?O(a,b):w(a)};else if(X(G,"getRangeAt")&&"number"==typeof G.rangeCount)fa=function(a){if(ca&&D&&"Control"==a.docSelection.type)R(a);else if(a._ranges.length=a.rangeCount=a.nativeSelection.rangeCount,a.rangeCount){for(var d=0,e=a.rangeCount;d<e;++d)a._ranges[d]=new c.WrappedRange(a.nativeSelection.getRangeAt(d));
n(a,a._ranges[a.rangeCount-1],ma(a.nativeSelection));a.isCollapsed=b(a)}else w(a)};else{if(!ba||"boolean"!=typeof G.isCollapsed||"boolean"!=typeof ja.collapsed||!L.implementsDomRange)return d.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;fa=function(a){var c;c=a.nativeSelection;c.anchorNode?(c=da(c,0),a._ranges=[c],a.rangeCount=1,c=a.nativeSelection,a.anchorNode=c.anchorNode,a.anchorOffset=c.anchorOffset,a.focusNode=c.focusNode,a.focusOffset=c.focusOffset,
a.isCollapsed=b(a)):w(a)}}t.refresh=function(a){var b=a?this._ranges.slice(0):null,c=this.anchorNode,d=this.anchorOffset;if(fa(this),a){a=b.length;if(a!=this._ranges.length||this.anchorNode!=c||this.anchorOffset!=d)return!0;for(;a--;)if(!W(b[a],this._ranges[a]))return!0;return!1}};var oa=function(a,b){var c=a.getAllRanges();a.removeAllRanges();for(var d=0,e=c.length;d<e;++d)W(b,c[d])||a.addRange(c[d]);a.rangeCount||w(a)};ca&&D?t.removeRange=function(a){if("Control"==this.docSelection.type){var b,
c=this.docSelection.createRange();a=C(a);b=M(c.item(0));for(var d=y(b).createControlRange(),e=!1,f=0,g=c.length;f<g;++f)b=c.item(f),b!==a||e?d.add(c.item(f)):e=!0;d.select();R(this)}else oa(this,a)}:t.removeRange=function(a){oa(this,a)};var ma;!B&&ba&&L.implementsDomRange?(ma=p,t.isBackward=function(){return ma(this)}):ma=t.isBackward=function(){return!1};t.isBackwards=t.isBackward;t.toString=function(){for(var a=[],b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")};t.collapse=
function(a,b){z(this,a);var d=c.createRange(a);d.collapseToPoint(a,b);this.setSingleRange(d);this.isCollapsed=!0};t.collapseToStart=function(){if(!this.rangeCount)throw new S("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)};t.collapseToEnd=function(){if(!this.rangeCount)throw new S("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)};t.selectAllChildren=function(a){z(this,a);var b=c.createRange(a);b.selectNodeContents(a);
this.setSingleRange(b)};t.deleteFromDocument=function(){if(ca&&D&&"Control"==this.docSelection.type){for(var a,b=this.docSelection.createRange();b.length;)a=b.item(0),b.remove(a),x.removeNode(a);this.refresh()}else if(this.rangeCount&&(a=this.getAllRanges(),a.length)){this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)a[b].deleteContents();this.addRange(a[c-1])}};t.eachRange=function(a,b){for(var c=0,d=this._ranges.length;c<d;++c)if(a(this.getRangeAt(c)))return b};t.getAllRanges=function(){var a=
[];return this.eachRange(function(b){a.push(b)}),a};t.setSingleRange=function(a,b){this.removeAllRanges();this.addRange(a,b)};t.callMethodOnEachRange=function(a,b){var c=[];return this.eachRange(function(d){c.push(d[a].apply(d,b||[]))}),c};t.setStart=A(!0);t.setEnd=A(!1);c.rangePrototype.select=function(a){ka(this.getDocument()).setSingleRange(this,a)};t.changeEachRange=function(a){var b=[],c=this.isBackward();this.eachRange(function(c){a(c);b.push(c)});this.removeAllRanges();c&&1==b.length?this.addRange(b[0],
"backward"):this.setRanges(b)};t.containsNode=function(a,b){return this.eachRange(function(c){return c.containsNode(a,b)},!0)||!1};t.getBookmark=function(a){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[a])}};t.moveToBookmark=function(a){for(var b,d,e=[],f=0;b=a.rangeBookmarks[f++];)d=c.createRange(this.win),d.moveToBookmark(b),e.push(d);a.backward?this.setSingleRange(e[0],"backward"):this.setRanges(e)};t.saveRanges=function(){return{backward:this.isBackward(),
ranges:this.callMethodOnEachRange("cloneRange")}};t.restoreRanges=function(a){this.removeAllRanges();for(var b,c=0;b=a.ranges[c];++c)this.addRange(b,a.backward&&0==c)};t.toHtml=function(){var a=[];return this.eachRange(function(b){a.push(J.toHtml(b))}),a.join("")};L.implementsTextRange&&(t.getNativeTextRange=function(){var a;if(a=this.docSelection){a=a.createRange();if(E(a))return a;throw d.createError("getNativeTextRange: selection is a control selection");}if(0<this.rangeCount)return c.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));
throw d.createError("getNativeTextRange: selection contains no range");});t.getName=function(){return"WrappedSelection"};t.inspect=function(){return Q(this)};t.detach=function(){r(this.win,"delete");m(this)};v.detachAll=function(){r(null,"deleteAll")};v.inspect=Q;v.isDirectionBackward=e;c.Selection=v;c.selectionPrototype=t;c.addShimListener(function(a){"undefined"==typeof a.getSelection&&(a.getSelection=function(){return ka(a)});a=null})});var Ga=!1,U=function(c){Ga||(Ga=!0,!l.initialized&&l.config.autoInitialize&&
Y())};return O&&("complete"==document.readyState?U():(n(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",U,!1),ra(window,"load",U))),l},this);
(function(n,w){"function"==typeof define&&define.amd?define(["./rangy-core"],n):"undefined"!=typeof module&&"object"==typeof exports?module.exports=n(require("rangy")):n(w.rangy)})(function(n){return n.createModule("SaveRestore",["WrappedRange"],function(n,S){function w(d,g){var f,n="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),u=ka.getDocument(d.startContainer);d=d.cloneRange();return d.collapse(g),f=u.createElement("span"),f.id=n,f.style.lineHeight="0",f.style.display="none",f.className=
"rangySelectionBoundary",f.appendChild(u.createTextNode(fa)),d.insertNode(f),f}function aa(d,g,f,n){(d=(d||document).getElementById(f))?(g[n?"setStartBefore":"setEndBefore"](d),P(d)):S.warn("Marker element has been removed. Cannot restore selection.")}function ea(d,g){return g.compareBoundaryPoints(d.START_TO_START,d)}function C(d,g){var f,p,u=n.DomRange.getRangeDocument(d),C=d.toString();g=T(g);return d.collapsed?(p=w(d,!1),{document:u,markerId:p.id,collapsed:!0}):(p=w(d,!1),f=w(d,!0),{document:u,
startMarkerId:f.id,endMarkerId:p.id,collapsed:!1,backward:g,toString:function(){return"original text: '"+C+"', new text: '"+d.toString()+"'"}})}function E(d,g){var f=d.document;"undefined"==typeof g&&(g=!0);var p=n.createRange(f);d.collapsed?(d=(f||document).getElementById(d.markerId))?(d.style.display="inline",(f=d.previousSibling)&&3==f.nodeType?(P(d),p.collapseToPoint(f,f.length)):(p.collapseBefore(d),P(d))):S.warn("Marker element has been removed. Cannot restore selection."):(aa(f,p,d.startMarkerId,
!0),aa(f,p,d.endMarkerId,!1));return g&&p.normalizeBoundaries(),p}function Y(d,g){var f,p,u=[];f=T(g);d=d.slice(0);d.sort(ea);g=0;for(p=d.length;g<p;++g)u[g]=C(d[g],f);for(g=p-1;0<=g;--g)f=d[g],p=n.DomRange.getRangeDocument(f),f.collapsed?f.collapseAfter((p||document).getElementById(u[g].markerId)):(f.setEndBefore((p||document).getElementById(u[g].endMarkerId)),f.setStartAfter((p||document).getElementById(u[g].startMarkerId)));return u}function Z(d){for(var g=[],f=d.length-1;0<=f;f--)g[f]=E(d[f],
!0);return g}function J(d,g){(d=(d||document).getElementById(g))&&P(d)}var ka=n.dom,P=ka.removeNode,T=n.Selection.isDirectionBackward,fa="\ufeff";n.util.extend(n,{saveRange:C,restoreRange:E,saveRanges:Y,restoreRanges:Z,saveSelection:function(d){if(!n.isSelectionValid(d))return S.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var g=n.getSelection(d),f=g.getAllRanges(),p=1==f.length&&g.isBackward(),u=Y(f,p);return p?
g.setSingleRange(f[0],p):g.setRanges(f),{win:d,rangeInfos:u,restored:!1}},restoreSelection:function(d,g){if(!d.restored){var f=d.rangeInfos,p=n.getSelection(d.win),u=Z(f);1==f.length&&g&&n.features.selectionHasExtend&&f[0].backward?(p.removeAllRanges(),p.addRange(u[0],!0)):p.setRanges(u);d.restored=!0}},removeMarkerElement:J,removeMarkers:function(d){for(var g,f=d.rangeInfos,n=0,u=f.length;n<u;++n)g=f[n],g.collapsed?J(d.doc,g.markerId):(J(d.doc,g.startMarkerId),J(d.doc,g.endMarkerId))}})}),n},this);